<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Moon AI Trading Platform</title>

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet"
  />

  <!-- CSS Modules (order matters) -->
  <link rel="stylesheet" href="src/styles/design-tokens.css">
  <link rel="stylesheet" href="src/styles/layout.css">
  <link rel="stylesheet" href="src/styles/components.css">
  <link rel="stylesheet" href="src/styles/tradingview-atomic.css">
  <link rel="stylesheet" href="src/styles/enterprise.css">
</head>
<body>
  <!-- Authentication Modal -->
  <div class="auth-modal" id="auth-modal">
    <div class="auth-container">
      <div class="auth-header">
        <div class="logo" style="justify-content: center;">
          <div class="logo-icon">‚¨¢</div>
          Moon<span>AI</span> Trading
        </div>
        <p>Access your AI-powered trading dashboard</p>
      </div>

      <div class="auth-tabs">
        <div class="auth-tab active" data-tab="login">Log In</div>
        <div class="auth-tab" data-tab="signup">Sign Up</div>
      </div>

      <div class="auth-form-container">
        <form class="auth-form" id="login-form">
          <div class="form-group">
            <label for="login-email">Email</label>
            <input type="email" id="login-email" placeholder="you@email.com" required />
          </div>
          <div class="form-group">
            <label for="login-password">Password</label>
            <input type="password" id="login-password" placeholder="Your password" required />
          </div>
          <button type="submit" class="auth-button">Log In</button>
          <div class="auth-message" id="login-message"></div>
        </form>

        <form class="auth-form" id="signup-form" style="display: none;">
          <div class="form-group">
            <label for="signup-email">Email</label>
            <input type="email" id="signup-email" placeholder="you@email.com" required />
          </div>
          <div class="form-group">
            <label for="signup-password">Password</label>
            <input type="password" id="signup-password" placeholder="Choose a strong password" required />
          </div>
          <button type="submit" class="auth-button">Create Account</button>
          <div class="auth-message" id="signup-message"></div>
        </form>
      </div>
    </div>
  </div>

  <header class="platform-header">
    <div class="logo">
      <div class="logo-icon">‚¨¢</div>
      Moon<span>AI</span> Trading
    </div>
    <div class="search-bar">
      <input type="text" placeholder="Search for assets, indicators or patterns..." />
    </div>
    <div class="user-controls">
      <button id="login-button" class="platform-button">Log In</button>
      <button id="watchlist-button" class="platform-button secondary">Watchlists</button>
      <div class="user-profile" id="user-profile" style="display: none;">
        <div class="user-avatar">A</div>
      </div>
    </div>
  </header>

  <div class="platform-container tv-layout" id="platform-container">
    <!-- Left Sidebar (Watchlist) -->
    <aside class="left-sidebar tv-left-panel" id="left-sidebar">
      <div id="watchlist-container">
        <!-- Watchlist items will be populated here -->
        <div class="stock-item" data-symbol="BTCUSDT">
          <div class="stock-info">
            <div class="stock-symbol">BTC</div>
            <div class="stock-company">Bitcoin</div>
          </div>
          <div class="stock-price-info">
            <div class="stock-price">$43,250</div>
            <div class="stock-change positive">+1.2%</div>
          </div>
        </div>
        <div class="stock-item active" data-symbol="ETHUSDT">
          <div class="stock-info">
            <div class="stock-symbol">ETH</div>
            <div class="stock-company">Ethereum</div>
          </div>
          <div class="stock-price-info">
            <div class="stock-price">$2,275</div>
            <div class="stock-change positive">+0.8%</div>
          </div>
        </div>
        <div class="stock-item" data-symbol="SOLUSDT">
          <div class="stock-info">
            <div class="stock-symbol">SOL</div>
            <div class="stock-company">Solana</div>
          </div>
          <div class="stock-price-info">
            <div class="stock-price">$102.45</div>
            <div class="stock-change negative">-1.3%</div>
          </div>
        </div>
        <div class="stock-item" data-symbol="XRPUSDT">
          <div class="stock-info">
            <div class="stock-symbol">XRP</div>
            <div class="stock-company">Ripple</div>
          </div>
          <div class="stock-price-info">
            <div class="stock-price">$0.6152</div>
            <div class="stock-change positive">+2.7%</div>
          </div>
        </div>
        <div class="stock-item" data-symbol="ADAUSDT">
          <div class="stock-info">
            <div class="stock-symbol">ADA</div>
            <div class="stock-company">Cardano</div>
          </div>
          <div class="stock-price-info">
            <div class="stock-price">$0.5891</div>
            <div class="stock-change negative">-0.4%</div>
          </div>
        </div>
        <div class="stock-item" data-symbol="DOTUSDT">
          <div class="stock-info">
            <div class="stock-symbol">DOT</div>
            <div class="stock-company">Polkadot</div>
          </div>
          <div class="stock-price-info">
            <div class="stock-price">$7.42</div>
            <div class="stock-change positive">+0.5%</div>
          </div>
        </div>
      </div>
    </aside>
    <div class="sidebar-toggle tv-panel-toggle left" id="sidebar-toggle" data-panel="left">
      <span>‚óÄ</span>
    </div>

    <!-- Main Chart Area -->
    <main class="chart-area tv-chart-area">
      <!-- Enhanced Chart Header -->
      <div class="chart-header">
        <div class="chart-symbol-display">
          <span class="symbol">MSFT</span>
          <div class="price-display">
            <span class="current-price" id="chart-price">312.79</span>
            <span class="price-change up" id="chart-change">+2.48 (+0.80%)</span>
          </div>
        </div>
        <div class="chart-toolbar">
          <div class="chart-type-selector">
            <button class="chart-type-btn" data-type="line" title="Line Chart">üìà</button>
            <button class="chart-type-btn active" data-type="candle" title="Candlestick">üïØÔ∏è</button>
            <button class="chart-type-btn" data-type="area" title="Area Chart">üìä</button>
          </div>
          <div class="toolbar-separator"></div>
          <div class="toolbar-group">
            <button class="control-button active" id="view-toggle-btn" data-tooltip="Switch between 2D and 3D chart views">
              <span class="icon">üåê</span> 3D
            </button>
            <button class="control-button" id="indicator-btn" data-tooltip="Add technical indicators">
              <span class="icon">üìâ</span> Indicators
            </button>
            <button class="control-button" id="comparison-btn" data-tooltip="Compare with other assets">
              <span class="icon">‚öñÔ∏è</span> Compare
            </button>
          </div>
          <div class="toolbar-separator"></div>
          <!-- Candle Interval Selector (NEW - Week 1 Quick Win) -->
          <div class="interval-selector toolbar-group">
            <!-- Second-based intervals (WebSocket only) -->
            <button class="interval-btn interval-seconds" data-interval="1s" title="1 second candles (WebSocket only)">1s</button>
            <button class="interval-btn interval-seconds" data-interval="5s" title="5 second candles (WebSocket only)">5s</button>
            <button class="interval-btn interval-seconds" data-interval="10s" title="10 second candles (WebSocket only)">10s</button>
            <button class="interval-btn interval-seconds" data-interval="15s" title="15 second candles (WebSocket only)">15s</button>
            <button class="interval-btn interval-seconds" data-interval="30s" title="30 second candles (WebSocket only)">30s</button>
            <!-- Minute-based intervals -->
            <button class="interval-btn" data-interval="1" title="1 minute candles">1m</button>
            <button class="interval-btn" data-interval="3" title="3 minute candles">3m</button>
            <button class="interval-btn" data-interval="5" title="5 minute candles">5m</button>
            <button class="interval-btn" data-interval="15" title="15 minute candles">15m</button>
            <button class="interval-btn" data-interval="30" title="30 minute candles">30m</button>
            <!-- Hour-based intervals -->
            <button class="interval-btn active" data-interval="60" title="1 hour candles">1h</button>
            <button class="interval-btn" data-interval="240" title="4 hour candles">4h</button>
            <!-- Day/Week/Month intervals -->
            <button class="interval-btn" data-interval="D" title="Daily candles">1D</button>
            <button class="interval-btn" data-interval="W" title="Weekly candles">1W</button>
            <button class="interval-btn" data-interval="M" title="Monthly candles">1M</button>
          </div>
          <div class="toolbar-separator"></div>
          <div class="toolbar-group">
            <button class="control-button" id="time-warp-btn" data-tooltip="Visualize historical trends">Time-Warp</button>
            <button class="control-button" id="lens-btn" data-tooltip="Toggle gravitational lens effect">Lens</button>
          </div>
        </div>
      </div>

      <div class="chart-wrapper">
        <!-- Loading overlay for the chart specifically -->
        <div class="chart-loading" id="chart-loading">
          <div class="loader"></div>
          <div style="margin-top: 15px; color: var(--text-color);">
            Loading market data...
          </div>
        </div>
        
        <!-- Main chart container -->
        <!-- 2D Chart container (Lightweight Charts) -->
        <div id="chart-2d-container" style="width: 100%; height: 100%;"></div>

        <!-- TradingView-style Context Menu -->
        <div id="chart-context-menu" class="chart-context-menu">
          <div class="context-menu-item" data-action="auto-scale">
            <span><span class="checkmark">‚úì</span>Auto (fits data to screen)</span>
          </div>
          <div class="context-menu-item" data-action="lock-ratio">
            <span>Lock price to bar ratio</span>
            <span class="shortcut">0.0008</span>
          </div>
          <div class="context-menu-item active" data-action="scale-chart-only">
            <span><span class="checkmark">‚úì</span>Scale price chart only</span>
          </div>
          <div class="context-menu-item" data-action="invert-scale">
            <span>Invert scale</span>
            <span class="shortcut">‚å• I</span>
          </div>
          <div class="context-menu-divider"></div>
          <div class="context-menu-item active" data-action="regular-scale">
            <span><span class="checkmark">‚úì</span>Regular</span>
          </div>
          <div class="context-menu-item" data-action="percent-scale">
            <span>Percent</span>
            <span class="shortcut">‚å• P</span>
          </div>
          <div class="context-menu-item" data-action="indexed-scale">
            <span>Indexed to 100</span>
          </div>
          <div class="context-menu-item" data-action="logarithmic-scale">
            <span>Logarithmic</span>
            <span class="shortcut">‚å• L</span>
          </div>
          <div class="context-menu-divider"></div>
          <div class="context-menu-item" data-action="move-left">
            <span>Move scale to left</span>
          </div>
          <div class="context-menu-divider"></div>
          <div class="context-menu-item submenu">
            <span>Labels</span>
          </div>
          <div class="context-menu-item submenu">
            <span>Lines</span>
          </div>
          <div class="context-menu-item active" data-action="plus-button">
            <span><span class="checkmark">‚úì</span>Plus button</span>
          </div>
          <div class="context-menu-divider"></div>
          <div class="context-menu-item" data-action="more-settings">
            <span>‚öô More settings...</span>
          </div>
        </div>
      </div>

      <!-- Timeframe Controls -->
      <div class="timeframe-controls">
        <div class="timeframe-button" data-timeframe="1d">1D</div>
        <div class="timeframe-button active" data-timeframe="1w">1W</div>
        <div class="timeframe-button" data-timeframe="1m">1M</div>
        <div class="timeframe-button" data-timeframe="3m">3M</div>
        <div class="timeframe-button" data-timeframe="1y">1Y</div>
        <div class="timeframe-button" data-timeframe="all">ALL</div>
      </div>
    </main>

    <!-- Right Panels: Portfolio, Signals, AI, Sentiment, News -->
    <aside class="right-panels tv-right-panel" id="right-panels">
      <!-- Portfolio Panel with VaR -->
      <div class="portfolio-panel tv-portfolio" id="portfolio-panel">
        <div class="portfolio-header tv-panel-header">
          <h3>Portfolio</h3>
          <div class="tv-panel-controls">
            <span class="tv-panel-status live">LIVE</span>
            <button class="tv-panel-collapse" data-panel="portfolio" title="Collapse">‚àí</button>
          </div>
        </div>
        <div class="portfolio-value tv-portfolio-value">
          <div class="label">Total Value</div>
          <div class="amount" id="portfolio-value">$124,847.50</div>
          <div class="daily-change positive" id="portfolio-change">+$2,341.25 (+1.91%)</div>
        </div>
        <div class="risk-metrics tv-metrics-grid">
          <div class="risk-metric tv-metric" data-metric="win-rate">
            <div class="label">Win Rate <span class="info-icon tv-tooltip" data-tooltip="Win rate over last 30 trades">‚ìò</span></div>
            <div class="value success" id="win-rate">68.4%</div>
          </div>
          <div class="risk-metric tv-metric" data-metric="sharpe">
            <div class="label">Sharpe Ratio <span class="info-icon tv-tooltip" data-tooltip="Risk-adjusted return">‚ìò</span></div>
            <div class="value" id="sharpe-ratio">1.87</div>
          </div>
          <div class="risk-metric tv-metric" data-metric="max-dd">
            <div class="label">Max DD <span class="info-icon tv-tooltip" data-tooltip="Maximum Drawdown">‚ìò</span></div>
            <div class="value warning" id="max-dd">-8.2%</div>
          </div>
          <div class="risk-metric tv-metric" data-metric="profit-factor">
            <div class="label">Profit Factor</div>
            <div class="value" id="profit-factor">2.14</div>
          </div>
        </div>
        <div class="var-display tv-var-display">
          <div class="var-header">
            <span class="var-label">Value at Risk (VaR)</span>
            <span class="var-confidence tv-badge">95% CI</span>
          </div>
          <div class="var-values">
            <span class="var-value tv-var-value" id="var-value">-$3,745</span>
            <span class="var-percentage">(-3.0%)</span>
          </div>
        </div>
        <div class="position-list tv-positions-list">
          <div class="position-list-header">
            <h4 class="positions-count">Open Positions (3)</h4>
          </div>
          <div class="positions-items">
            <!-- Positions rendered dynamically by PortfolioController -->
          </div>
        </div>
      </div>

      <!-- Watchlist Panel -->
      <div class="panel tv-watchlist-panel" id="watchlist-panel" data-panel="watchlist" style="display: none;">
        <div class="panel-header tv-panel-header">
          <div class="panel-header-left">
            <h3>Watchlist</h3>
          </div>
          <div class="panel-header-controls">
            <div class="panel-link-indicator" data-panel="watchlist" title="Link Group">
              <span class="panel-link-dot blue"></span>
            </div>
            <button class="panel-detach-btn" data-panel="watchlist" title="Detach to new window">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              </svg>
            </button>
          </div>
        </div>
        <div class="panel-content watchlist-list tv-watchlist-list" id="watchlist-content">
          <div class="watchlist-search">
            <input type="text" placeholder="Search symbols..." class="watchlist-search-input" />
          </div>
          <div class="watchlist-items">
            <!-- Watchlist items rendered dynamically -->
          </div>
        </div>
      </div>

      <!-- Alerts Panel -->
      <div class="panel tv-alerts-panel" id="alerts-panel" data-panel="alerts" style="display: none;">
        <div class="panel-header tv-panel-header">
          <div class="panel-header-left">
            <h3>Alerts</h3>
            <span class="tv-badge">1 active</span>
          </div>
          <div class="panel-header-controls">
            <div class="panel-link-indicator" data-panel="alerts" title="Link Group">
              <span class="panel-link-dot blue"></span>
            </div>
            <button class="panel-detach-btn" data-panel="alerts" title="Detach to new window">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              </svg>
            </button>
          </div>
        </div>
        <div class="panel-content alerts-list tv-alerts-list" id="alerts-content">
          <!-- Alerts rendered dynamically -->
        </div>
      </div>

      <!-- AI Signals Panel with Grading -->
      <div class="panel tv-signals-panel" id="signals-panel" data-panel="signals">
        <div class="panel-header tv-panel-header">
          <div class="panel-header-left">
            <h3>AI Signals</h3>
          </div>
          <div class="panel-header-controls">
            <div class="signal-filters">
              <button class="signal-filter-btn active" data-filter="all">All</button>
              <button class="signal-filter-btn" data-filter="buy">Buy</button>
              <button class="signal-filter-btn" data-filter="sell">Sell</button>
            </div>
            <label class="auto-trade-toggle tv-toggle">
              <input type="checkbox" id="auto-trade-toggle">
              <span class="tv-toggle-slider"></span>
              <span class="tv-toggle-label">Auto</span>
            </label>
            <span class="signals-count tv-badge">3 pending</span>
            <div class="panel-link-indicator" data-panel="signals" title="Link Group">
              <span class="panel-link-dot blue"></span>
            </div>
            <button class="panel-detach-btn" data-panel="signals" title="Detach to new window">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              </svg>
            </button>
            <button class="clear-signals-btn tv-btn-icon" id="clear-signals" title="Clear all signals">‚úï</button>
          </div>
        </div>
        <div class="panel-content signals-list tv-signals-list" id="signals-content">
          <!-- Signals rendered dynamically by SignalsController -->
        </div>
      </div>

      <!-- AI Combined Panel (Predictions + Assistant) -->
      <div class="panel tv-ai-panel" id="ai-combined-panel" data-panel="ai" style="display: none;">
        <div class="panel-header tv-panel-header">
          <div class="panel-header-left">
            <h3>AI Assistant</h3>
          </div>
          <div class="panel-header-controls">
            <div class="ai-tabs">
              <button class="ai-tab-btn active" data-tab="predictions">Predictions</button>
              <button class="ai-tab-btn" data-tab="assistant">Chat</button>
            </div>
            <div class="panel-link-indicator" data-panel="ai" title="Link Group">
              <span class="panel-link-dot blue"></span>
            </div>
            <button class="panel-detach-btn" data-panel="ai" title="Detach to new window">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              </svg>
            </button>
            <div id="ai-refresh" style="cursor: pointer; font-size: 14px;">‚Üª</div>
          </div>
        </div>
        <div class="panel-content ai-combined-content" id="ai-combined-content">
          <!-- Tab: Predictions -->
          <div class="ai-tab-content active" data-tab="predictions" id="ai-content">
            <div class="skeleton skeleton-heading"></div>
            <div class="skeleton skeleton-text"></div>
            <div class="skeleton skeleton-text"></div>
            <div class="skeleton skeleton-text-short"></div>
          </div>
          <!-- Tab: Assistant Chat -->
          <div class="ai-tab-content" data-tab="assistant" style="display: none;">
            <div class="ai-chat-messages" id="ai-chat-messages">
              <div class="ai-message assistant">How can I help with your trading today?</div>
            </div>
            <div class="ai-chat-input">
              <input type="text" id="ai-chat-input" placeholder="Ask about markets, signals, or strategies..." />
              <button class="ai-chat-send" id="ai-chat-send">Send</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Screener Panel -->
      <div class="panel tv-screener-panel" id="screener-panel" data-panel="screener" style="display: none;">
        <div class="panel-header tv-panel-header">
          <div class="panel-header-left">
            <h3>Screener</h3>
          </div>
          <div class="panel-header-controls">
            <div class="screener-tabs">
              <button class="screener-tab-btn active" data-tab="stocks">Stocks</button>
              <button class="screener-tab-btn" data-tab="crypto">Crypto</button>
              <button class="screener-tab-btn" data-tab="custom">Custom</button>
            </div>
            <div class="panel-link-indicator" data-panel="screener" title="Link Group">
              <span class="panel-link-dot blue"></span>
            </div>
            <button class="panel-detach-btn" data-panel="screener" title="Detach to new window">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              </svg>
            </button>
          </div>
        </div>
        <div class="panel-content screener-content" id="screener-content">
          <!-- Screener content rendered dynamically -->
          <div class="screener-filters">
            <select class="screener-filter-select">
              <option value="">Add Filter...</option>
              <option value="rsi">RSI</option>
              <option value="macd">MACD</option>
              <option value="sma">SMA</option>
              <option value="volume">Volume</option>
              <option value="price">Price</option>
            </select>
          </div>
          <div class="screener-results">
            <div class="screener-loading">Loading results...</div>
          </div>
        </div>
      </div>

      <!-- Pine Script Panel -->
      <div class="panel tv-pine-panel" id="pine-panel" data-panel="pine" style="display: none;">
        <div class="panel-header tv-panel-header">
          <div class="panel-header-left">
            <h3>Pine Script</h3>
          </div>
          <div class="panel-header-controls">
            <button class="pine-action-btn" id="pine-new" title="New Script">New</button>
            <button class="pine-action-btn" id="pine-save" title="Save Script">Save</button>
            <div class="panel-link-indicator" data-panel="pine" title="Link Group">
              <span class="panel-link-dot blue"></span>
            </div>
            <button class="panel-detach-btn" data-panel="pine" title="Detach to new window">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              </svg>
            </button>
          </div>
        </div>
        <div class="panel-content pine-content" id="pine-content">
          <textarea class="pine-editor" id="pine-editor" placeholder="//@version=5
indicator(&quot;My Indicator&quot;, overlay=true)

// Your Pine Script code here
plot(close)"></textarea>
          <div class="pine-actions">
            <button class="pine-run-btn" id="pine-run">Run Script</button>
            <button class="pine-apply-btn" id="pine-apply">Apply to Chart</button>
          </div>
        </div>
      </div>

      <!-- Calendar Panel -->
      <div class="panel tv-calendar-panel" id="calendar-panel" data-panel="calendar" style="display: none;">
        <div class="panel-header tv-panel-header">
          <div class="panel-header-left">
            <h3>Economic Calendar</h3>
          </div>
          <div class="panel-header-controls">
            <div class="calendar-filters">
              <button class="calendar-filter-btn active" data-filter="all">All</button>
              <button class="calendar-filter-btn" data-filter="high">High Impact</button>
            </div>
            <div class="panel-link-indicator" data-panel="calendar" title="Link Group">
              <span class="panel-link-dot blue"></span>
            </div>
            <button class="panel-detach-btn" data-panel="calendar" title="Detach to new window">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              </svg>
            </button>
          </div>
        </div>
        <div class="panel-content calendar-content" id="calendar-content">
          <!-- Calendar events rendered dynamically -->
          <div class="calendar-loading">Loading calendar...</div>
        </div>
      </div>

      <!-- News & Sentiment Panel -->
      <div class="panel tv-news-panel" id="news-panel" data-panel="news" style="display: none;">
        <div class="panel-header tv-panel-header">
          <div class="panel-header-left">
            <h3>News & Sentiment</h3>
          </div>
          <div class="panel-header-controls">
            <div class="news-tabs">
              <button class="news-tab-btn active" data-tab="news">News</button>
              <button class="news-tab-btn" data-tab="sentiment">Sentiment</button>
            </div>
            <div class="panel-link-indicator" data-panel="news" title="Link Group">
              <span class="panel-link-dot blue"></span>
            </div>
            <button class="panel-detach-btn" data-panel="news" title="Detach to new window">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              </svg>
            </button>
            <div id="news-refresh" style="cursor: pointer; font-size: 14px;">‚Üª</div>
          </div>
        </div>
        <div class="panel-content news-combined-content" id="news-combined-content">
          <!-- Tab: News -->
          <div class="news-tab-content active" data-tab="news" id="news-content">
            <div class="skeleton skeleton-heading"></div>
            <div class="skeleton skeleton-text"></div>
            <div class="skeleton skeleton-text"></div>
            <div class="skeleton skeleton-text-short"></div>
          </div>
          <!-- Tab: Sentiment -->
          <div class="news-tab-content" data-tab="sentiment" id="sentiment-content" style="display: none;">
            <div class="skeleton skeleton-heading"></div>
            <div class="skeleton skeleton-text"></div>
            <div class="skeleton skeleton-text"></div>
            <div class="skeleton skeleton-text-short"></div>
          </div>
        </div>
      </div>

      <!-- Notifications Panel -->
      <div class="panel tv-notifications-panel" id="notifications-panel" data-panel="notifications" style="display: none;">
        <div class="panel-header tv-panel-header">
          <div class="panel-header-left">
            <h3>Notifications</h3>
            <span class="tv-badge">3 new</span>
          </div>
          <div class="panel-header-controls">
            <button class="mark-all-read-btn" id="mark-all-read" title="Mark all as read">Mark all read</button>
            <button class="panel-detach-btn" data-panel="notifications" title="Detach to new window">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              </svg>
            </button>
          </div>
        </div>
        <div class="panel-content notifications-content" id="notifications-content">
          <!-- Notifications rendered dynamically -->
          <div class="notification-item unread">
            <div class="notification-icon">üîî</div>
            <div class="notification-text">
              <div class="notification-title">AAPL Alert Triggered</div>
              <div class="notification-desc">Price crossed above $185.00</div>
              <div class="notification-time">2 minutes ago</div>
            </div>
          </div>
          <div class="notification-item unread">
            <div class="notification-icon">‚ö°</div>
            <div class="notification-text">
              <div class="notification-title">New AI Signal: NVDA</div>
              <div class="notification-desc">Buy signal with A+ grade</div>
              <div class="notification-time">5 minutes ago</div>
            </div>
          </div>
          <div class="notification-item unread">
            <div class="notification-icon">üìä</div>
            <div class="notification-text">
              <div class="notification-title">Screener Match</div>
              <div class="notification-desc">3 stocks match your custom filter</div>
              <div class="notification-time">10 minutes ago</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Panel -->
      <div class="panel tv-settings-panel" id="settings-panel" data-panel="settings" style="display: none;">
        <div class="panel-header tv-panel-header">
          <div class="panel-header-left">
            <h3>Settings</h3>
          </div>
          <div class="panel-header-controls">
            <!-- Settings not detachable -->
          </div>
        </div>
        <div class="panel-content settings-content" id="settings-content">
          <div class="settings-section">
            <h4>Appearance</h4>
            <div class="setting-item">
              <label>Theme</label>
              <select class="setting-select" id="theme-select">
                <option value="dark">Dark</option>
                <option value="light">Light</option>
                <option value="system">System</option>
              </select>
            </div>
          </div>
          <div class="settings-section">
            <h4>Notifications</h4>
            <div class="setting-item">
              <label>Sound Alerts</label>
              <label class="tv-toggle">
                <input type="checkbox" id="sound-alerts-toggle" checked>
                <span class="tv-toggle-slider"></span>
              </label>
            </div>
            <div class="setting-item">
              <label>Desktop Notifications</label>
              <label class="tv-toggle">
                <input type="checkbox" id="desktop-notifications-toggle" checked>
                <span class="tv-toggle-slider"></span>
              </label>
            </div>
          </div>
          <div class="settings-section">
            <h4>Trading</h4>
            <div class="setting-item">
              <label>Confirm Orders</label>
              <label class="tv-toggle">
                <input type="checkbox" id="confirm-orders-toggle" checked>
                <span class="tv-toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Help Panel -->
      <div class="panel tv-help-panel" id="help-panel" data-panel="help" style="display: none;">
        <div class="panel-header tv-panel-header">
          <div class="panel-header-left">
            <h3>Help Center</h3>
          </div>
          <div class="panel-header-controls">
            <!-- Help not detachable -->
          </div>
        </div>
        <div class="panel-content help-content" id="help-content">
          <div class="help-section">
            <h4>Keyboard Shortcuts</h4>
            <div class="shortcut-item">
              <span class="shortcut-key">Ctrl + \</span>
              <span class="shortcut-desc">Toggle sidebar</span>
            </div>
            <div class="shortcut-item">
              <span class="shortcut-key">Alt + 1-9</span>
              <span class="shortcut-desc">Quick panel access</span>
            </div>
            <div class="shortcut-item">
              <span class="shortcut-key">Ctrl + Shift + D</span>
              <span class="shortcut-desc">Detach current panel</span>
            </div>
          </div>
          <div class="help-section">
            <h4>Quick Links</h4>
            <a href="#" class="help-link">Documentation</a>
            <a href="#" class="help-link">Video Tutorials</a>
            <a href="#" class="help-link">Contact Support</a>
          </div>
        </div>
      </div>
    </aside>
    <!-- TradingView-Style Widgetbar Hider (Panel Toggle) -->
    <div class="panels-toggle tv-panel-toggle right widgetbar-hider" id="panels-toggle" data-panel="right" role="button" aria-label="Toggle right panel" aria-expanded="true" tabindex="0">
      <div class="hider-inner apply-common-tooltip common-tooltip-vertical common-tooltip-otl">
        <svg xmlns="http://www.w3.org/2000/svg" width="9" height="27" viewBox="0 0 9 27" class="hider-svg">
          <g fill="none" fill-rule="evenodd">
            <path class="background-pill" d="M4.5.5a4 4 0 0 1 4 4v18a4 4 0 1 1-8 0v-18a4 4 0 0 1 4-4z"></path>
            <path class="arrow-icon" d="M5.5 10l-2 3.5 2 3.5"></path>
          </g>
        </svg>
      </div>
      <span class="tv-tooltip">Hide panel</span>
    </div>

    <!-- TradingView-Style Right Widgetbar Toolbar -->
    <div class="tv-widgetbar" id="widgetbar" role="toolbar" aria-label="Right toolbar" aria-orientation="vertical">
      <div class="tv-widgetbar-tabs">
        <div class="tv-widgetbar-scroll">
          <div class="tv-widgetbar-content">
            <div class="tv-widgetbar-toolbar" data-name="right-toolbar">
              <!-- Watchlist Button -->
              <button
                aria-label="Watchlist, details and news"
                aria-pressed="false"
                type="button"
                class="tv-widgetbar-btn"
                data-name="base"
                data-tooltip="Watchlist"
                data-panel="watchlist"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 44" width="44" height="44">
                  <path fill="currentColor" d="M28 16H16v1h12v-1ZM28 20H16v1h12v-1ZM16 24h12v1H16v-1Z"></path>
                  <path fill="currentColor" fill-rule="evenodd" d="m22 30-10 4V12a1 1 0 0 1 1-1h18a1 1 0 0 1 1 1v22l-10-4Zm-9 2.52V12h18v20.52l-9-3.6-9 3.6Z"></path>
                </svg>
                <span class="tv-tooltip">Watchlist</span>
              </button>

              <!-- Alerts Button -->
              <button
                aria-label="Alerts"
                aria-pressed="false"
                type="button"
                class="tv-widgetbar-btn"
                data-name="alerts"
                data-tooltip="Alerts"
                data-panel="alerts"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 44" width="44" height="44">
                  <path fill="currentColor" d="M35 14.66 29.16 9l-.7.72 5.84 5.66.7-.72ZM9 14.66 14.84 9l.7.72-5.84 5.66-.7-.72ZM22 16v7h-5v1h6v-8h-1Z"></path>
                  <path fill="currentColor" fill-rule="evenodd" d="M22 33a11 11 0 1 0 0-22 11 11 0 0 0 0 22Zm0-1a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z"></path>
                </svg>
                <div class="tv-counter-row">
                  <span class="tv-counter small color-danger" aria-label="1 unread alert">1</span>
                </div>
                <span class="tv-tooltip">Alerts</span>
              </button>

              <!-- Object Tree / Signals Button -->
              <button
                aria-label="Object Tree and Signals"
                aria-pressed="true"
                type="button"
                class="tv-widgetbar-btn active"
                data-name="object_tree"
                data-tooltip="Signals"
                data-panel="signals"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 44" width="44" height="44">
                  <path fill="currentColor" d="M21.34 12.13a1 1 0 0 1 .98 0l10.41 5.93a1 1 0 0 1 0 1.73l-10.4 5.93a1 1 0 0 1-.99 0L10.78 19.8a1 1 0 0 1 0-1.75l10.56-5.92Zm.49.87-10.56 5.93 10.56 5.93 10.4-5.93L21.84 13ZM33.5 24.86l-11.66 6.8L10 25l.5-.87 11.33 6.38L32.99 24l.5.87Z"></path>
                </svg>
                <span class="tv-tooltip">Signals</span>
              </button>

              <!-- AI Chat Button -->
              <button
                aria-label="AI Assistant"
                aria-pressed="false"
                type="button"
                class="tv-widgetbar-btn"
                data-name="ai_chat"
                data-tooltip="AI Assistant"
                data-panel="ai"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 44" width="44" height="44" fill="none">
                  <path fill="currentColor" fill-rule="evenodd" d="M11 14.5a2.5 2.5 0 0 1 2.5-2.5h13a2.5 2.5 0 0 1 2.5 2.5v9a2.5 2.5 0 0 1-2.5 2.5H14.3l-.15.15L11 29.29V14.5Zm2.5-3.5a3.5 3.5 0 0 0-3.5 3.5v17.2l.85-.85L14.71 27H19v.5a3.5 3.5 0 0 0 3.5 3.5H29.3l3.86 3.85.85.86V22.5a3.5 3.5 0 0 0-3.5-3.5H30v-4.5a3.5 3.5 0 0 0-3.5-3.5h-13ZM30 20v3.5a3.5 3.5 0 0 1-3.5 3.5H20v.5a2.5 2.5 0 0 0 2.5 2.5H29.7l.15.15L33 33.29V22.5a2.5 2.5 0 0 0-2.5-2.5H30Z"></path>
                </svg>
                <span class="tv-tooltip">AI Assistant</span>
              </button>

              <!-- Spacer/Filler -->
              <div class="tv-widgetbar-filler"></div>

              <!-- Screeners Button -->
              <button
                aria-label="Screeners"
                aria-pressed="false"
                type="button"
                class="tv-widgetbar-btn"
                data-name="screener"
                data-tooltip="Screeners"
                data-panel="screener"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 44" width="44" height="44" fill="currentColor">
                  <g clip-path="url(#screener-a)">
                    <path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M22 8a14 14 0 1 0 0 28 14 14 0 0 0 0-28ZM9 22a13 13 0 0 1 22.03-9.35L27.5 16.2a8 8 0 1 0 .68.73l3.55-3.55A13 13 0 1 1 9 22Zm17.79-5.1a7 7 0 1 0 .68.74l-3.62 3.6A2 2 0 0 1 22 24a2 2 0 1 1 1.25-3.56l3.54-3.54Z"></path>
                  </g>
                  <defs>
                    <clipPath id="screener-a">
                      <path fill="currentColor" d="M0 0h44v44H0z"></path>
                    </clipPath>
                  </defs>
                </svg>
                <span class="tv-tooltip">Screeners</span>
              </button>

              <!-- Pine Script / Strategy Button -->
              <button
                aria-label="Pine Script"
                aria-pressed="false"
                type="button"
                class="tv-widgetbar-btn"
                data-name="pine"
                data-tooltip="Strategy Editor"
                data-panel="pine"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 44" width="44" height="44">
                  <path fill="currentColor" d="M22.38 10.18a.5.5 0 0 0-.78.02l-9.5 12.5a.5.5 0 0 0 .57.77l6.85-2.4 5.72 4.81c.17.14.4.16.59.04l5.93-3.75a.5.5 0 0 0 .12-.74zm-8.47 11.8L22 11.3l8.73 10.33-5.14 3.25-5.65-4.76a.5.5 0 0 0-.5-.1z"></path>
                  <path fill="currentColor" d="M13.64 26 9.1 32.2a.5.5 0 0 0 .4.8h25a.5.5 0 0 0 .4-.8L30.36 26l-.8.59 3.95 5.4H10.5l3.96-5.4z"></path>
                </svg>
                <span class="tv-tooltip">Strategy Editor</span>
              </button>

              <!-- Calendar Button -->
              <button
                aria-label="Economic Calendar"
                aria-pressed="false"
                type="button"
                class="tv-widgetbar-btn"
                data-name="calendar"
                data-tooltip="Calendar"
                data-panel="calendar"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 44" width="44" height="44">
                  <path fill="currentColor" fill-rule="evenodd" d="M15 11h2v4h-2v-4Zm-1 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v1h8v-1a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v1h1a3 3 0 0 1 3 3v16a3 3 0 0 1-3 3H13a3 3 0 0 1-3-3V15a3 3 0 0 1 3-3h1v-1Zm4 2h8v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2h1a2 2 0 0 1 2 2v4H11v-4c0-1.1.9-2 2-2h1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2Zm-7 7v11c0 1.1.9 2 2 2h18a2 2 0 0 0 2-2V20H11Zm18-9h-2v4h2v-4Z"></path>
                </svg>
                <span class="tv-tooltip">Calendar</span>
              </button>

              <!-- Community/News Button -->
              <button
                aria-label="News & Community"
                aria-pressed="false"
                type="button"
                class="tv-widgetbar-btn"
                data-name="community"
                data-tooltip="News"
                data-panel="news"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 44" width="44" height="44">
                  <path fill="currentColor" d="M24.78 15.6a.9.9 0 0 1-1.31.96l-1.47-.8-1.47.8a.9.9 0 0 1-1.31-.96l.3-1.64-1.2-1.15a.9.9 0 0 1 .5-1.54l1.65-.22.72-1.51.07-.12a.9.9 0 0 1 1.55.12l.72 1.5 1.65.23a.9.9 0 0 1 .5 1.54l-1.2 1.15zm-1.3-1.51a.9.9 0 0 1 .27-.82l1.1-1.04-1.5-.2a.9.9 0 0 1-.7-.5L22 10.16l-.65 1.37a.9.9 0 0 1-.7.5l-1.5.2 1.1 1.04a.9.9 0 0 1 .27.82l-.28 1.49 1.33-.73.1-.04a1 1 0 0 1 .66 0l.1.04 1.33.73zm4.88 5.27a9 9 0 0 1-12.72 0l-.03-.03.63-.79.1.11a8 8 0 0 0 11.32 0l.12-.13.64.78zm3.86 4.6a15 15 0 0 1-20.4.04l.63-.78a14 14 0 0 0 19.14-.03zm3.8 4.66a21 21 0 0 1-28 .05l.64-.78a20 20 0 0 0 26.73-.04z"></path>
                </svg>
                <div class="tv-counter-row">
                  <span class="tv-counter small color-danger" aria-label="New updates">5</span>
                </div>
                <span class="tv-tooltip">News</span>
              </button>

              <!-- Notifications Button -->
              <button
                aria-label="Notifications"
                aria-pressed="false"
                type="button"
                class="tv-widgetbar-btn"
                data-name="notifications"
                data-tooltip="Notifications"
                data-panel="notifications"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 44" width="44" height="44" fill="none">
                  <path fill="currentColor" d="M22 8a3.99 3.99 0 0 1 3.941 3.303A10 10 0 0 1 32 20.496v6.554a2.501 2.501 0 0 1-.5 4.95h-5.626a4.002 4.002 0 0 1-7.748 0H12.5a2.5 2.5 0 0 1-.5-4.95v-6.554c0-4.123 2.496-7.664 6.059-9.193A3.99 3.99 0 0 1 22 8m-2.83 24a3.001 3.001 0 0 0 5.66 0zm-6.67-4a1.5 1.5 0 0 0 0 3h19a1.5 1.5 0 0 0 0-3zM22 8.987a3 3 0 0 0-2.956 2.486L18.95 12l-.498.222A9 9 0 0 0 13 20.496V27h18v-6.504a9 9 0 0 0-5.453-8.274L25.049 12l-.093-.527A3 3 0 0 0 22 8.987"></path>
                </svg>
                <div class="tv-counter-row">
                  <span class="tv-counter small color-warning" aria-label="3 notifications">3</span>
                </div>
                <span class="tv-tooltip">Notifications</span>
              </button>

              <!-- Separator -->
              <div class="tv-widgetbar-separator"></div>

              <!-- Settings Button -->
              <button
                aria-label="Settings"
                aria-pressed="false"
                type="button"
                class="tv-widgetbar-btn"
                data-name="settings"
                data-tooltip="Settings"
                data-panel="settings"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 44" width="44" height="44" fill="none">
                  <path fill="currentColor" d="M22 8c7.732 0 14 6.268 14 14s-6.268 14-14 14S8 29.732 8 22 14.268 8 22 8m-8 22a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1zm7 0a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1zm7 0a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1zm-14-7a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1zm7 0a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1zm7 0a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1zm-14-7a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1zm7 0a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1zm7 0a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1z"></path>
                </svg>
                <span class="tv-tooltip">Settings</span>
              </button>

              <!-- Help Button -->
              <button
                aria-label="Help Center"
                aria-pressed="false"
                type="button"
                class="tv-widgetbar-btn"
                data-name="help"
                data-tooltip="Help Center"
                data-panel="help"
              >
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 44 44" width="44" height="44" fill="none">
                  <path fill="currentColor" d="M22 8c7.732 0 14 6.268 14 14s-6.268 14-14 14S8 29.732 8 22 14.268 8 22 8m0 1C14.82 9 9 14.82 9 22s5.82 13 13 13 13-5.82 13-13S29.18 9 22 9m.201 18.01A2.016 2.016 0 0 1 24 29l-.01.204A2.017 2.017 0 0 1 22 31l-.201-.01a2.02 2.02 0 0 1-1.788-1.785L20 29c0-1.104.917-2 2-2zM22 28c-.537 0-1 .455-1 1s.462 1 1 1 1-.455 1-1-.462-1-1-1m.31-15C24.9 13 27 15.1 27 17.69a4.31 4.31 0 0 1-2.195 3.754l-.872.492a2.81 2.81 0 0 0-1.433 2.45V25h-1v-.614c0-1.377.743-2.647 1.942-3.322l.872-.49A3.31 3.31 0 0 0 26 17.688 3.69 3.69 0 0 0 22.31 14H22a4 4 0 0 0-4 4h-1a5 5 0 0 1 5-5z"></path>
                </svg>
                <span class="tv-tooltip">Help Center</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Execution Bar (1-Click Trading) -->
    <div class="execution-bar tv-execution-bar" id="execution-bar">
      <!-- Symbol + Live Price -->
      <div class="trade-header tv-trade-symbol">
        <div class="symbol-info">
          <span class="symbol" id="trade-symbol">MSFT</span>
          <span class="price live" id="trade-price">$312.79</span>
          <span class="change positive" id="trade-change">+0.8%</span>
        </div>
        <div class="live-pnl positive" id="live-pnl">+$1,247.50</div>
      </div>

      <!-- Position Sizer (Kelly Criterion) -->
      <div class="position-sizer tv-position-sizer">
        <div class="sizer-group">
          <label class="sizer-label">Shares</label>
          <input type="number" class="sizer-input tv-input" id="shares-input" name="shares" value="100" min="1" step="1">
        </div>
        <div class="sizer-group">
          <label class="sizer-label">$</label>
          <input type="number" class="sizer-input tv-input" id="dollar-input" name="dollar" value="31279" min="1" step="100">
        </div>
        <div class="sizer-group">
          <label class="sizer-label">Risk %</label>
          <input type="number" class="sizer-input tv-input" id="risk-input" name="risk" value="2" min="0.1" max="100" step="0.1">
        </div>
        <button class="kelly-btn tv-kelly-btn" id="kelly-btn" title="Calculate optimal position using Kelly Criterion">
          <span class="kelly-icon">K</span>
          Kelly
        </button>
      </div>

      <!-- Trade Buttons -->
      <div class="trade-buttons tv-trade-actions">
        <button class="trade-button buy tv-trade-btn" id="buy-btn">
          <span class="btn-icon">‚ñ≤</span>
          BUY
        </button>
        <button class="trade-button sell tv-trade-btn" id="sell-btn">
          <span class="btn-icon">‚ñº</span>
          SELL
        </button>
      </div>

      <!-- Emergency Stop -->
      <button class="emergency-stop tv-emergency-btn" id="emergency-stop">
        <span class="stop-icon">‚¨¢</span>
        CLOSE ALL
      </button>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loading-overlay">
    <div class="loader-container">
      <div class="loader"></div>
      <div class="loading-message">Loading Moon AI Trading Platform</div>
      <div class="loading-progress">
        <div class="loading-progress-bar" id="loading-progress-bar"></div>
      </div>
      <div class="loading-tasks">
        <div class="loading-task">
          <div class="loading-task-status">
            <div class="loading-task-pending" id="task-initialize"></div>
          </div>
          <div>Initializing platform components</div>
        </div>
        <div class="loading-task">
          <div class="loading-task-status">
            <div class="loading-task-pending" id="task-connect"></div>
          </div>
          <div>Connecting to market data</div>
        </div>
        <div class="loading-task">
          <div class="loading-task-status">
            <div class="loading-task-pending" id="task-ai"></div>
          </div>
          <div>Loading AI prediction models</div>
        </div>
        <div class="loading-task">
          <div class="loading-task-status">
            <div class="loading-task-pending" id="task-chart"></div>
          </div>
          <div>Preparing 3D visualization</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Voice Assistant -->
  <div class="voice-assistant" id="voice-assistant">
    <div class="voice-assistant-icon" id="voice-assistant-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path>
        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
        <line x1="12" x2="12" y1="19" y2="22"></line>
      </svg>
    </div>
    <div class="voice-assistant-panel" id="voice-assistant-panel">
      <div class="voice-panel-header">
        <div>Moon AI Assistant</div>
        <div class="voice-panel-close" id="voice-panel-close">‚úï</div>
      </div>
      <div class="voice-panel-body" id="voice-panel-content">
        <div class="assistant-message">How can I help with your trading today?</div>
      </div>
      <div class="voice-panel-footer">
        <input type="text" id="voice-input" placeholder="Ask something or press mic..." />
        <button id="voice-mic-button">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"></path>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
            <line x1="12" x2="12" y1="19" y2="22"></line>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Custom Indicator Modal -->
  <div class="custom-indicator-modal" id="custom-indicator-modal">
    <div class="custom-indicator-container">
      <div class="modal-header">
        <h3>Custom Indicator Editor</h3>
        <div class="modal-close" id="indicator-modal-close">‚úï</div>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Name</label>
          <input type="text" id="indicator-name" placeholder="Indicator name" />
        </div>
        <div class="form-group">
          <label>Script</label>
          <textarea id="indicator-script" rows="8" placeholder="// Example:
function myIndicator(data) {
  // Calculate values
  const result = data.map(candle => ({
    price: candle.close,
    signal: candle.close > candle.open ? 'buy' : 'sell'
  }));
  return result;
}"></textarea>
        </div>
        <div class="form-group">
          <label>Settings</label>
          <div class="indicator-settings">
            <div class="setting">
              <label>Color</label>
              <input type="color" id="indicator-color" value="#6c5ce7" />
            </div>
            <div class="setting">
              <label>Line Width</label>
              <input type="range" id="indicator-width" min="1" max="5" value="2" />
            </div>
            <div class="setting">
              <label>Style</label>
              <select id="indicator-style">
                <option>Solid</option>
                <option>Dashed</option>
                <option>Dotted</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="platform-button secondary" id="indicator-cancel">Cancel</button>
        <button class="platform-button" id="indicator-save">Save</button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toast-container"></div>
  

  <!-- External Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lightweight-charts@3.8.0/dist/lightweight-charts.standalone.production.js"></script>

  <!-- Single Entry Point (ES6 Module) -->
  <script type="module" src="src/main.js"></script>
</body>
</html>
